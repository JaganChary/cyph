{
	"rules": {
		".read": false,
		".write": false,

		"channels": {
			"$channel": {
				".read": true,
				".write": true,

				"disconnects": {
					"$user": {
						".validate": "newData.val() === now"
					}
				},

				"lock": {
					"$contender": {
						"id": {
							".validate": "newData.isString()"
						},
						"reason": {
							".validate": "newData.isString()"
						}
					}
				},

				"messages": {
					"$message": {
						".write": "!data.exists() && newData.exists()",
						".validate": "newData.hasChildren(['chunkIndex', 'cyphertext', 'id', 'numChunks', 'sender', 'timestamp'])",

						"chunkIndex": {
							".validate": "newData.isNumber()"
						},

						"cyphertext": {
							".validate": "newData.isString()"
						},

						"id": {
							".validate": "newData.isString()"
						},

						"numChunks": {
							".validate": "newData.isNumber()"
						},

						"sender": {
							".validate": "newData.isString() && root.child('channels').child($channel).child('users').child(newData.val()).exists()"
						},

						"timestamp": {
							".validate": "newData.val() === now"
						},

						"$other": {
							".validate": false
						}
					}
				},

				"users": {
					"$user": {
						".write": "!data.exists() && newData.exists()",
						".validate": "newData.isString() && (newData.val() === '' || newData.val() === $user)"
					}
				}
			}
		},

		"ephemeral": {
			"$file": {
				".read": true,
				".write": "!data.exists() && newData.exists()",
				".validate": "newData.isString()"
			}
		},

		"users": {
			"$user": {
				".read": "($user + '@cyph.me') === auth.token.email",
				".write": "($user + '@cyph.me') === auth.token.email",

				"certificate": {
					".read": true,
					".write": false,
					".validate": "newData.isString()"
				},

				"contactList": {
					".validate": "newData.isString()"
				},

				"contacts": {
					"$contact": {
						"messages": {
							"$message": {
								".validate": "newData.isString()"
							}
						},
						"session": {
							".validate": "newData.isString()"
						}
					}
				},

				"encryptionKeyPair": {
					".validate": "newData.isString()"
				},

				"fileList": {
					".validate": "newData.isString()"
				},

				"files": {
					"$file": {
						"messages": {
							"$message": {
								".validate": "newData.isString()"
							}
						},
						"session": {
							".validate": "newData.isString()"
						}
					}
				},

				"locks": {
					"$contender": {
						"id": {
							".validate": "newData.isString()"
						},
						"reason": {
							".validate": "newData.isString()"
						}
					}
				},

				"loginData": {
					".read": true,
					".validate": "newData.isString()"
				},

				"publicProfile": {
					".read": true,
					".validate": "newData.isString()"
				},

				"settings": {
					".validate": "newData.isString()"
				},

				"signingKeyPair": {
					".validate": "newData.isString()"
				},

				"$other": {
					".validate": false
				}
			}
		}
	}
}
