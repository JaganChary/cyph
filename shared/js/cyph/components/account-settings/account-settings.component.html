<div
	fxFlexFill
	fxLayout='row'
	fxLayoutAlign='center center'
	[class.initiating]='loading | async'
>
	<form
		ngNativeValidate
		fxFlex
		fxFlex.gt-md='75'
		fxFlex.gt-lg='50'
		fxLayout='column'
		fxLayoutGap='16px'
		(submit)='save()'
		*ngIf='state === states.default; else changePassword'
	>
		<div></div>

		<mat-form-field>
			<input
				matInput
				cyphTranslate
				[(ngModel)]='data.modified.name'
				name='name'
				placeholder='Name'
				required
			/>
		</mat-form-field>
		<mat-form-field>
			<input
				matInput
				cyphTranslate
				[(ngModel)]='data.modified.realUsername'
				[textMask]='usernameMask'
				name='realUsername'
				placeholder='Username Capitalization'
				required
			/>
		</mat-form-field>
		<mat-form-field>
			<input
				matInput
				cyphTranslate
				[(ngModel)]='data.modified.email'
				name='email'
				type='email'
				placeholder='Email'
			/>
		</mat-form-field>

		<div></div>
		<div>
			<strong>{{stringsService.pin}}:</strong>
			&ngsp;
			&nbsp;
			<span>&#xfe61;&#xfe61;&#xfe61;&#xfe61;</span>
			&ngsp;
			(<a (click)='state = states.pin' cyphTranslate>change</a>)
		</div>
		<div>
			<strong>{{stringsService.masterKey}}:</strong>
			&ngsp;
			&nbsp;
			<span>
				&#xfe61;&#xfe61;&#xfe61;&#xfe61;&#xfe61;
				&#xfe61;&#xfe61;&#xfe61;&#xfe61;&#xfe61;
				&#xfe61;&#xfe61;&#xfe61;&#xfe61;&#xfe61;
				&#xfe61;&#xfe61;&#xfe61;&#xfe61;&#xfe61;
			</span>
			&ngsp;
			(<a (click)='state = states.masterKey' cyphTranslate>change</a>)
		</div>

		<div></div>
		<div>
			<strong cyphTranslate>Premium Status:</strong>
			&ngsp;
			&nbsp;
			<span *ngIf='
				accountDatabaseService.currentUser.value?.user.hasPremium | async; else getPremium
			'>
				{{stringsService.enabled}}
			</span>
			<ng-template #getPremium>
				<span>{{stringsService.disabled}}</span>
				&ngsp;
				(<a
					[href]='envService.homeWordPressUrl + "pricing/#accounts"'
					cyphTranslate
					target='_blank'
				>upgrade now</a>)
			</ng-template>
		</div>

		<div></div>
		<cyph-account-storage-analytics></cyph-account-storage-analytics>
		<div></div>
		<div></div>
		<div></div>

		<div fxLayout='row' fxLayoutAlign='center'>
			<button mat-raised-button cyphTranslate type='submit' [disabled]='!ready'>
				Save
			</button>
		</div>

		<div></div>
	</form>

	<ng-template #changePassword>
		<div fxFlex fxLayout='column' fxLayoutGap='16px'>
			<div fxLayout='row' fxLayoutAlign='center center' class='password-title'>
				<h2>{{
					state === states.masterKey ?
						stringsService.changeMasterKeyTitle :
					state === states.pin ?
						stringsService.changePinTitle :
						''
				}}</h2>
				<button
					mat-icon-button
					cyphTranslate
					matTooltip='Back'
					(click)='state = states.default'
				>
					<mat-icon>arrow_back</mat-icon>
				</button>
			</div>

			<cyph-account-register
				[getMasterKeyOnly]='state === states.masterKey'
				[getPinOnly]='state === states.pin'
				(submitMasterKey)='changeMasterKey($event)'
				(submitPIN)='changePIN($event)'
			></cyph-account-register>
		</div>
	</ng-template>

	<mat-progress-spinner
		mode='indeterminate'
		*ngIf='loading | async'
	></mat-progress-spinner>
</div>
